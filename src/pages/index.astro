---
import Layout from "../layouts/Layout.astro";
import InnerLayout from "../layouts/InnerLayout.astro";
import Divider from "../components/Divider.astro";

import japan_image from "../assets/japan_map.jpg";
import welcome_image from "../assets/welcome.jpg";

import { SITE_TITLE, SITE_SUBTITLE, focuses, projects } from "../consts";
---

<Layout title="Home" excludeInnerLayout={true}>
  <div id="top-hero" class="fixed top-0 left-0 w-full h-145 2xl:h-190 -z-1">
    <div
      style={"background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), " +
        "url(" +
        japan_image.src +
        "); background-size: cover; background-position: center"}
      class="w-full h-full"
    >
    </div>
    <div
      id="hero-text"
      class="z-2 text-white absolute w-full flex flex-col items-center justify-center px-4 md:px-0 drop-shadow-md md:w-3/4 lg:w-1/2 text-center"
      style="top: 0; height: 100px; left: 50%; transform: translateX(-50%);"
    >
      <p class="text-3xl md:text-5xl text-shadow-lg">{SITE_TITLE}</p>
      <p class="text-md md:text-2xl mt-2 text-shadow-lg">
        {SITE_SUBTITLE}
      </p>
    </div>
  </div>

  <div class="h-90 lg:h-100 2xl:h-145 -z-10"></div>

  <InnerLayout>
    <div class="w-full mx-auto flex flex-col items-center justify-center">
      <!-- Welcome -->
      <div class="w-full bg-card rounded-lg p-6 md:p-10">
        <div class="flex flex-col md:flex-row md:items-start gap-6">
          <div class="w-full md:w-1/2">
            <h2 class="text-2xl md:text-3xl font-bold mb-3">Welcome!</h2>
            <p class="md:mb-4 text-text-light">
              Kenyon Bowers here! I'm a Baptist Christian, Bible believer,
              Japanese Bible enthusiast, and wannabe scholar and linguist. This
              website is where you can find my blog posts, projects, and other
              content related my mission.
            </p>
          </div>

          <div class="w-full md:w-1/2">
            <img
              src={welcome_image.src}
              alt="#"
              class="w-full h-48 md:h-56 lg:h-64 object-cover rounded-md shadow-md"
            />
          </div>
        </div>
      </div>

      <Divider />

      <!-- Main Focuses -->
      <section class="w-full">
        <h2 class="text-2xl md:text-3xl font-bold mb-3">Focuses:</h2>
        <div class="timeline">
          <!-- Focus Item 1 -->
          <div class="timeline-item">
            <div class="timeline-img-wrapper">
              <img
                src={focuses[0].image}
                alt={focuses[0].title}
                class="timeline-img"
              />
            </div>
            <div class="timeline-content">
              <h4 class="font-semibold">{focuses[0].title}</h4>
              <p class="text-text-light">
                {focuses[0].description}
              </p>
            </div>
          </div>

          <!-- Focus Item 2 -->
          <div class="timeline-item md:text-right flex-row-reverse">
            <div class="w-full md:w-[52%]">
              <img
                src={focuses[1].image}
                alt={focuses[1].title}
                class="timeline-img"
              />
            </div>
            <div class="timeline-content md:text-left">
              <h4 class="font-semibold">{focuses[1].title}</h4>
              <p class="text-text-light">
                {focuses[1].description}
              </p>
            </div>
          </div>

          <!-- Focus Item 3 -->
          <div class="timeline-item">
            <div class="timeline-img-wrapper">
              <img
                src={focuses[2].image}
                alt={focuses[2].title}
                class="timeline-img"
              />
            </div>
            <div class="timeline-content">
              <h4 class="font-semibold">{focuses[2].title}</h4>
              <p class="text-text-light">
                {focuses[2].description}
              </p>
            </div>
          </div>
        </div>
      </section>

      <Divider />

      <!-- Projects -->
      <section class="w-full bg-card rounded-lg p-6 md:p-10" id="projects">
        <div class="mb-6">
          <h2 class="text-2xl md:text-3xl font-bold">Projects:</h2>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <a
            href={projects[0].url}
            target="_blank"
            class="bg-inner-card rounded-lg shadow-sm hover:shadow-lg transition-shadow p-6"
          >
            <header class="mb-4">
              <h3 class="text-xl md:text-xl font-semibold">
                {projects[0].title}
              </h3>
            </header>

            <ul class="space-y-3">
              <li class="text-text">
                <div class="text-sm text-text-light">
                  {projects[0].description}
                </div>
              </li>
            </ul>
          </a>

          <a
            href={projects[1].url}
            class="bg-inner-card rounded-lg shadow-sm hover:shadow-lg transition-shadow p-6"
          >
            <header class="mb-4">
              <h3 class="text-xl md:text-xl font-semibold">
                {projects[1].title}
              </h3>
            </header>

            <ul class="space-y-3">
              <li class="flex items-center text-text">
                <div class="text-sm text-text-light">
                  {projects[1].description}
                </div>
              </li>
            </ul>
          </a>
        </div>
      </section>
    </div>
  </InnerLayout>

  <style>
    .timeline {
      position: relative;
      max-width: 900px;
      margin: 0 auto;
      padding: 1rem 0;
    }

    .timeline::before {
      content: "";
      position: absolute;
      left: 50%;
      top: 0;
      transform: translateX(-50%);
      width: 4px;
      height: 100%;
      background: rgba(0, 0, 0, 0.12);
      z-index: 0;
      border-radius: 2px;
    }

    .timeline-item {
      position: relative;
      display: flex;
      align-items: center;
      gap: 1rem;
      margin: 2rem 0;
      z-index: 1;
      opacity: 0;
      transform: translateY(20px);
      transition:
        opacity 600ms ease,
        transform 600ms ease;
    }

    .timeline-item.in-view {
      opacity: 1;
      transform: none;
    }

    /* Node that sits on the central line */
    .timeline-item::before {
      content: "";
      position: absolute;
      left: 50%;
      top: 50%;
      /* default (md and up): centered on the vertical midpoint */
      transform: translate(-50%, -50%);
      width: 14px;
      height: 14px;
      background: white;
      border: 3px solid #cb3437;
      border-radius: 50%;
      box-shadow: 0 0 0 4px rgba(203, 52, 55, 0.06);
      z-index: 2;
    }

    .timeline-img-wrapper {
      width: 52%;
      flex-shrink: 0;
    }

    .timeline-img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
      display: block;
    }

    .timeline-content {
      width: 44%;
      padding: 0.75rem 1rem;
      background: var(--astro-color-card, #fff);
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.04);
    }

    @media (max-width: 768px) {
      .timeline::before {
        left: 8px;
      }

      .timeline-item {
        flex-direction: column;
        align-items: flex-start;
        padding-left: 1.5rem;
      }

      .timeline-item::before {
        left: 8px;
        transform: translateX(-50%);
      }

      .timeline-img-wrapper,
      .timeline-content {
        width: 100%;
      }

      .timeline-img {
        height: 160px;
      }
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const header = document.getElementById("main-header");
      const hero = document.getElementById("top-hero");
      const heroText = document.getElementById("hero-text");

      if (!hero || !heroText) return;

      const update = () => {
        const heroRect = hero.getBoundingClientRect();
        const headerHeight = header ? header.getBoundingClientRect().height : 0;
        const visibleHeight = Math.max(0, heroRect.height - headerHeight);

        heroText.style.top = `${headerHeight}px`;
        heroText.style.height = `${visibleHeight}px`;
        heroText.style.left = "50%";
        heroText.style.transform = "translateX(-50%)";
      };

      window.addEventListener("resize", update);

      const ro = new ResizeObserver(update);
      if (header) ro.observe(header);
      ro.observe(hero);

      update();
      // Timeline intersection observer: fade-in items as they enter viewport
      const timelineItems = document.querySelectorAll(".timeline-item");
      if (timelineItems && timelineItems.length) {
        const tObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("in-view");
                // optionally unobserve to keep it performant
                tObserver.unobserve(entry.target);
              }
            });
          },
          { root: null, rootMargin: "0px 0px -10% 0px", threshold: 0.15 }
        );

        timelineItems.forEach((it, i) => tObserver.observe(it));
      }
    });
  </script>
</Layout>
